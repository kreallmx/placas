<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil | Kreall</title>

  <!-- OJO: el ?v=3 es para evitar caché -->
  <link rel="stylesheet" href="style.css?v=3" />
</head>
<body>
  <main class="wrap">

    <section class="card">
      <div class="hero">
        <img class="avatar" src="https://i.ibb.co/h1MTs9Sh/Martha.jpg" alt="Foto" />
        <div>
          <h1 class="h1">Martha</h1>
          <p class="sub">Si me encontraste, por favor contacta a mi humano.</p>
        </div>
      </div>

      <div class="alert">Estoy perdida. Gracias por ayudarme a volver a casa.</div>

      <div class="actions">
        <a class="btn" href="tel:+529981310327">Llamar</a>
        <a class="btn wa" href="https://wa.me/5219981310327" target="_blank" rel="noopener">WhatsApp</a>
        <a class="btn locate" href="#" id="sendLocation">Enviar ubicación</a>
      </div>

      <div class="grid">
        <div class="field">
          <div class="label">Mi humano</div>
          <div class="value">Karina Peraza</div>
        </div>
      </div>

      <div class="grid">
        <div class="field">
          <div class="label">Zona</div>
          <div class="value">Sm. 23</div>
        </div>

        <div class="field">
          <div class="label">Notas</div>
          <div class="value">Respondo a mi nombre, soy muy miedosa, no soy agresiva. Me gusta que me hablen bonito y me den sobresitos. Ya estoy esterilizada.</div>
        </div>
      </div>

      <div class="small">
        Diseñado por Kreall ·
        <a class="sutil" href="https://www.instagram.com/kreall.mx/" target="_blank" rel="noopener">Instagram</a>
        <a class="sutil" href="https://www.facebook.com/kreall.mx/" target="_blank" rel="noopener">Facebook</a>
      </div>
    </section>

  </main>

  <script>
    // WhatsApp del dueño (sin +, sin espacios)
    // Debe coincidir con el WhatsApp al que quieres que llegue la ubicación
    const OWNER_WA = "5219981310327";

    const btn = document.getElementById("sendLocation");

    btn.addEventListener("click", (e) => {
      e.preventDefault();

      if (!navigator.geolocation) {
        alert("Tu teléfono no soporta la función de ubicación.");
        return;
      }

      const originalText = btn.textContent;
      btn.textContent = "Obteniendo ubicación...";
      btn.style.opacity = "0.9";

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;

          const petName = (document.querySelector(".h1")?.textContent || "tu mascota").trim();
          const mapsLink = `https://maps.google.com/?q=${lat},${lon}`;

          const msg = encodeURIComponent(
            `Hola, encontré a ${petName}. Estoy aquí: ${mapsLink}`
          );

          // Abre WhatsApp con el mensaje listo
          window.location.href = `https://wa.me/${OWNER_WA}?text=${msg}`;
        },
        (err) => {
          btn.textContent = originalText;
          btn.style.opacity = "1";

          if (err.code === 1) {
            alert("Necesitas permitir el acceso a tu ubicación para enviarla.");
          } else if (err.code === 2) {
            alert("No se pudo obtener tu ubicación. Intenta de nuevo en un lugar con mejor señal.");
          } else {
            alert("Se tardó demasiado en obtener la ubicación. Intenta otra vez.");
          }
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    });
  </script>

</body>
</html>
